# IC-Expert 项目开发过程日志

## 项目名称：基于 RAG 的集成电路垂直领域智能问答助手

## 开发者:eric

## Phase 1: 核心引擎构建 (RAG Pipeline)

### 环境搭建与技术选型

动作：初始化 Python 3.10 虚拟环境，确定技术栈为 LangChain + ChromaDB + FastAPI。

决策：考虑到集成电路（IC）文档多为 PDF 格式（Datasheet, Standard），决定使用 PyPDFLoader 作为文档加载器。

测试：配置 .env 文件，成功调用 DeepSeek API 完成第一次 Hello World 对话。

### 向量数据库与文本切分 (遇到的坑)

动作：编写 rag_core.py，实现文档加载 -> 切分 -> 向量化 -> 存储。

问题：在使用默认 chunk_size=500 切分 Verilog 教程时，发现代码块（如 module ... endmodule）经常被切断，导致检索语义不完整。

解决：调整 RecursiveCharacterTextSplitter 参数，将 chunk_size 增加至 800，并设置 chunk_overlap=100，保证了代码块和上下文的完整性。

优化：在 create_vector_db 函数中增加了“强制重建”逻辑（使用 shutil.rmtree），确保每次更新 PDF 后数据库能彻底刷新，避免脏数据残留。

### 检索链路联调

动作：集成 Embedding 模型（本地 all-MiniLM-L6-v2），完成数据入库。

测试：输入问题 "什么是 Verilog？"，成功召回 Top-3 相关片段。

结果：验证了本地向量库 chroma_db 的持久化存储功能正常。

## Phase 2: 后端服务化 (Backend Engineering)

### FastAPI 接口开发

动作：新建 server.py，使用 FastAPI 封装 RAG 逻辑。

设计：定义 RESTful 接口 POST /chat。

数据校验：引入 Pydantic 定义 QueryRequest 模型，确保输入数据格式安全。

调试：使用 Swagger UI (/docs) 进行接口测试。遇到 404 Not Found 错误，经排查是未定义根路径 /，直接访问 /docs 解决。

验证：使用 curl 命令测试接口，成功返回 JSON 格式的检索结果（见测试截图）。

### 业务逻辑完善

动作：在后端接入 LLM 生成模块。

Prompt 优化：设计了“IC 专家”人设的 System Prompt。

Before: "回答这个问题。" -> 回答过于泛泛。

After: "你是一名集成电路专家。请基于参考资料回答。如果涉及 Verilog 代码，请检查语法闭合。" -> 回答准确率显著提升。

功能增加：在返回结果中增加了 sources 字段，实现了“来源溯源”功能。

## Phase 3: 前端交互与产品化 (Frontend & Polish)

### Streamlit 界面开发

动作：新建 app.py，构建 Web 交互界面。

交互设计：采用“左侧边栏上传文件，右侧主界面对话”的布局。

逻辑打通：前端使用 requests 库调用后端 http://127.0.0.1:8000/chat 接口，实现了流式对话体验。

问题修复：解决 PDF 文件名中文乱码问题，确保前端能正确显示参考来源的文件名。

### 最终验收与文档

动作：整理代码结构，清理冗余注释。

文档：编写 README.md 和 requirements.txt，完成项目归档。

自测：上传一份全新的 FPGA 手册，执行全流程测试，响应时间控制在 3秒以内，检索准确无误。

总结：项目已完成从数据处理到应用交付的闭环，核心 RAG 检索效果在 IC 垂直领域表现符合预期。
